---
title: "Results Report"
date: "12/17/2021"
output: html_document
---

## Model descriptions  
Due to correlations between several of our explanatory variables, we opted to create three models that tested separate hypotheses: disturbance model, native plant model, and total plant model. Dependent variables include abundance, species richness, and Shannon diversity. Species richness and Shannon diversity were rarified using the `iNEXT` package to account for differences in sampling effort across sites.  

The disturbance model includes a binary variable of disturbed/undisturbed, measured by Jesse in the field and is based on % mowed with sites that have over approximately 30% mowed marked as disturbed. We also created buffers around each site and calculated the % area that is anthropogenic in each buffer (anthropogenic defined as settlement or roads). Eight buffer distances were tested: 20 m, 50 m, 100 m, 200 m, 500 m, 1000 m, 2000 m, and 5000 m based on Rivest & Kharouba (2021, *Canadian Journal of Zoology*) and Kuussaari et al. (2021, *Urban Ecosystems*).  

The native plants model includes number of native species found at each site and average cover of native plant bloom in each quadrat at each site. The total plant model used the same measures but included all flowering plants observed at each site.  

Below represents the general code used for each model: 
```{r, echo = T, eval = F}
# disturbance model
dist <- lm(response ~ Disturbance * anthroper, data = df)
# native species model 
nat <- lm(response ~ nnative * avgnatbloom, data = df)
# full species model 
full <- lm(response ~ nspecies * avgbloom, data = df)
# null 
null <- lm(response ~ 1, data = x)
```


---


## Study System
```{r, echo = F, eval = T}
knitr::include_graphics("/home/icrichmond/Repositories/urban-butterflies/figures/StudyArea.jpg")
```


---


## Buffer Distances
To test which buffer distance performed best, we took the top performing model (disturbance for all) for each response variable and did AICc model ranking at each buffer distance. Species richness and Shannon diversity were best explained at similar scales, around 1 km. Abundance had top-ranking models with much smaller buffer distances.   
**NOTE:** delta AICc <2 are best performing models, with anything within  ~2.18 delta AICc of each other performing the same (statistically indistinguishable).  

**Table 1.** AICc table of buffer distances for abundance models. All models compared are disturbance models, as disturbance was the top ranking model for abundance. Numbers in model name refer to the buffer distance (i.e., Modnames = AbDist50 = abundance disturbance model at 50 m buffer distance)
```{r, echo = F, eval=T}
a <- readRDS("/home/icrichmond/Repositories/urban-butterflies/large/AbundanceBufferAIC.rds")

knitr::kable(a) 
```

**Table 2.** AICc table of buffer distances for species richness models. All models compared are disturbance models, as disturbance was the top ranking model for species richness Numbers in model name refer to the buffer distance (i.e., Modnames = SRDist1000 = species richness disturbance model at 1000 m buffer distance)
```{r, echo = F, eval=T}
sr <- readRDS("/home/icrichmond/Repositories/urban-butterflies/large/SpeciesRichnessBufferAIC.rds")

knitr::kable(sr) 
```

**Table 3.** AICc table of buffer distances for Shannon diversity models. All models compared are disturbance models, as disturbance was the top ranking model for Shannon diversity. Numbers in model name refer to the buffer distance (i.e., Modnames = ShDist1000 = Shannon diversity disturbance model at 1000 m buffer distance)
```{r, echo = F, eval=T}
sr <- readRDS("/home/icrichmond/Repositories/urban-butterflies/large/ShannonBufferAIC.rds")

knitr::kable(sr) 
```


---


## Top Models 
To demonstrate the top model at each of the top buffer distances, here are the AICc tables at the best buffer distances for each response variables. We have AICc tables at each buffer distance but are only presenting them for top buffer distances here as to simplify the information being presented.  

### Abundance 
**Table 4a.** AICc table ranking abundance models at 50 m, one of three buffer distances found within 2 delta AICc.
```{r, echo = F, eval=T}
a <- readRDS("/home/icrichmond/Repositories/urban-butterflies/large/AbundanceAIC.rds")

knitr::kable(a$AbDist50) 
```

**Table 4b.** AICc table ranking abundance models at 20 m, one of three buffer distances found within 2 delta AICc.
```{r, echo = F, eval=T}
a <- readRDS("/home/icrichmond/Repositories/urban-butterflies/large/AbundanceAIC.rds")

knitr::kable(a$AbDist20) 
```

**Table 4c.** AICc table ranking abundance models at 5000 m, one of three buffer distances found within 2 delta AICc.
```{r, echo = F, eval=T}
a <- readRDS("/home/icrichmond/Repositories/urban-butterflies/large/AbundanceAIC.rds")

knitr::kable(a$AbDist5000) 
```

### Species Richness 
**Table 5a.** AICc table ranking species richness models at 1000 m, one of three buffer distances found within 2 delta AICc.
```{r, echo = F, eval=T}
sr <- readRDS("/home/icrichmond/Repositories/urban-butterflies/large/SpeciesRichnessAIC.rds")

knitr::kable(sr$SRDist1000) 
```

**Table 5b.** AICc table ranking species richness models at 2000 m, one of three buffer distances found within 2 delta AICc.
```{r, echo = F, eval=T}
sr <- readRDS("/home/icrichmond/Repositories/urban-butterflies/large/SpeciesRichnessAIC.rds")

knitr::kable(sr$SRDist2000) 
```

**Table 5c.** AICc table ranking species richness models at 100 m, one of three buffer distances found within 2 delta AICc.
```{r, echo = F, eval=T}
sr <- readRDS("/home/icrichmond/Repositories/urban-butterflies/large/SpeciesRichnessAIC.rds")

knitr::kable(sr$SRDist100) 
```
**NOTE: top-ranking disturbance model is not significantly different than the null, will not present this model summary table** 

### Shannon Diversity 
**Table 6a.** AICc table ranking species richness models at 1000 m, one of two buffer distances found within 2 delta AICc.
```{r, echo = F, eval=T}
sh <- readRDS("/home/icrichmond/Repositories/urban-butterflies/large/ShannonAIC.rds")

knitr::kable(sh$ShDist1000) 
```

**Table 6b.** AICc table ranking species richness models at 100 m, one of two buffer distances found within 2 delta AICc.
```{r, echo = F, eval=T}
sh <- readRDS("/home/icrichmond/Repositories/urban-butterflies/large/ShannonAIC.rds")

knitr::kable(sh$ShDist100) 
```


---


## Top Model Summaries
We investigate the top models at each buffer distance to see which variables are driving these relationships. An important consideration is that our models are explaining a high amount of variation, even when there are not statistically significant relationships. One factor that I think may be driving this is that we do not actually see very much variation in our dataset which is an important consideration for when we write up the results we have found.  

### Abundance
**Table 7a.** Summary table for abundance disturbance model at 50 m buffer distance.
```{r, echo = F, eval=T}
library(magrittr)
ab <- readRDS("/home/icrichmond/Repositories/urban-butterflies/large/AbundanceDistModels.rds")
ab <- ab$AbDist50 
names(ab$coefficients) <- c('Intercept', 'Undisturbed','Anthropogenic (%)','Interaction')
ab %>% broom::tidy() %>% knitr::kable()
```

**Table 7b.** Summary table for abundance disturbance model at 20 m buffer distance.
```{r, echo = F, eval=T}
library(magrittr)
ab <- readRDS("/home/icrichmond/Repositories/urban-butterflies/large/AbundanceDistModels.rds")
ab <- ab$AbDist20 
names(ab$coefficients) <- c('Intercept', 'Undisturbed','Anthropogenic (%)','Interaction')
ab %>% broom::tidy() %>% knitr::kable()
```

**Table 7c.** Summary table for abundance disturbance model at 5000 m buffer distance.
```{r, echo = F, eval=T}
library(magrittr)
ab <- readRDS("/home/icrichmond/Repositories/urban-butterflies/large/AbundanceDistModels.rds")
ab <- ab$AbDist5000 
names(ab$coefficients) <- c('Intercept', 'Undisturbed','Anthropogenic (%)','Interaction')
ab %>% broom::tidy() %>% knitr::kable()
```

### Species Richness 
**Table 8a.** Summary table for species richness disturbance model at 1000 m buffer distance.
```{r, echo = F, eval=T}
library(magrittr)
sr <- readRDS("/home/icrichmond/Repositories/urban-butterflies/large/SpeciesRichnessDistModels.rds")
sr <- sr$SRDist1000 
names(sr$coefficients) <- c('Intercept', 'Undisturbed','Anthropogenic (%)','Interaction')
sr %>% broom::tidy() %>% knitr::kable()
```

**Table 8b.** Summary table for species richness disturbance model at 2000 m buffer distance.
```{r, echo = F, eval=T}
library(magrittr)
sr <- readRDS("/home/icrichmond/Repositories/urban-butterflies/large/SpeciesRichnessDistModels.rds")
sr <- sr$SRDist2000 
names(sr$coefficients) <- c('Intercept', 'Undisturbed','Anthropogenic (%)','Interaction')
sr %>% broom::tidy() %>% knitr::kable()
```

### Shannon Diversity
**Table 9a.** Summary table for Shannon diversity disturbance model at 1000 m buffer distance.
```{r, echo = F, eval=T}
library(magrittr)
sh <- readRDS("/home/icrichmond/Repositories/urban-butterflies/large/ShannonDistModels.rds")
sh <- sh$ShDist1000 
names(sh$coefficients) <- c('Intercept', 'Undisturbed','Anthropogenic (%)','Interaction')
sh %>% broom::tidy() %>% knitr::kable()
```

**Table 9b.** Summary table for Shannon diversity disturbance model at 100 m buffer distance.
```{r, echo = F, eval=T}
library(magrittr)
sh <- readRDS("/home/icrichmond/Repositories/urban-butterflies/large/ShannonDistModels.rds")
sh <- sh$ShDist100 
names(sh$coefficients) <- c('Intercept', 'Undisturbed','Anthropogenic (%)','Interaction')
sh %>% broom::tidy() %>% knitr::kable()
```

### Model Performance
**Table 10**. R<sup> 2 </sup> values for the top model at each buffer distance. Same values are presented graphically in Figure 4.
```{r, echo = F, eval=T, message=F, warning=F, }
#### PACKAGES #### 
library(purrr)
library(dplyr)
library(tidyr)
library(stringr)
#### DATA ##### 
# abundance models 
ab <- readRDS("large/AbundanceTopModels.rds")
# species richness models 
sr <- readRDS("large/SpeciesRichnessTopModels.rds")
# shannon models 
sh <- readRDS("large/ShannonTopModels.rds")

#### CLEANING #### 
# extract R^2 values 
abr2 <- purrr::map_dfr(.x = ab, .f = function(x){summary(x)$r.squared})
srr2 <- purrr::map_dfr(.x = sr, .f = function(x){summary(x)$r.squared})
shr2 <- purrr::map_dfr(.x = sh, .f = function(x){summary(x)$r.squared})
# pivot datasets    
abr2 <- pivot_longer(abr2, cols = everything(), names_to = "model", values_to = "rsquared")
srr2 <- pivot_longer(srr2, cols = everything(), names_to = "model", values_to = "rsquared")
shr2 <- pivot_longer(shr2, cols = everything(), names_to = "model", values_to = "rsquared")
# bind
r2 <- rbind(abr2, srr2, shr2)
r2 <- r2%>% 
  mutate(modeltype = case_when(str_detect(model, 'Ab') ~ 'Abundance',
                               str_detect(model, 'SR') ~ 'SpeciesRichness',
                               str_detect(model, 'Sh') ~ 'Shannon')) %>% 
  mutate(distance = str_replace_all(model, c("AbDist" = "", "SRDist" = "", "ShDist" = "")) )
r2$distance <- as.numeric(r2$distance)
r2$distance <- as.factor(r2$distance)
r2 <- select(r2, model, modeltype, distance, rsquared)
knitr::kable(r2, col.names = c("Model", "Response Variable", "Buffer Distance (m)", "R2"), digits = 3)
```


---


## Figures 
The following figures represent the statistically significant relationships that we found in the "Top Model Summaries" section. There is a lot of info to visualize, so I would love some suggestions on how to best incorportate this data.

```{r, echo = F, eval = T}
knitr::include_graphics("/home/icrichmond/Repositories/urban-butterflies/figures/AbundanceModels.png")
```
**Figure 1.** Regressions showing the relationships between abundance and statistically significant explanatory variables for the top-ranked buffer distances. Relationships are shown while accounting for other variables in the model using the `visreg` package. A) Effect of disturbance on abundance at 20 m B) Effect of disturbance on abundance at 5000 m. 

```{r, echo = F, eval = T}
knitr::include_graphics("/home/icrichmond/Repositories/urban-butterflies/figures/SpeciesRichnessModels.png")
```
**Figure 2.** Regressions showing the relationships between species richness and statistically significant explanatory variables for the top-ranked buffer distances. Relationships are shown while accounting for other variables in the model using the `visreg` package. A) Effect of anthropogenic land-use area (%) on species richness at 1000 m B) Effect of anthropogenic land-use area (%) on species richness at 2000 m.

```{r, echo = F, eval = T}
knitr::include_graphics("/home/icrichmond/Repositories/urban-butterflies/figures/Shannon1000mModel.png")
```
**Figure 3a.** Regressions showing the relationships between Shannon diversity and statistically significant explanatory variables for the 1000 m buffer distance. Relationships are shown while accounting for other variables in the model using the `visreg` package. A) Effect of disturbance B) Effect of anthropogenic land-use area (%) C) Interaction effect of disturbance and anthropogenic land-ues area (%)

```{r, echo = F, eval = T}
knitr::include_graphics("/home/icrichmond/Repositories/urban-butterflies/figures/Shannon100mModel.png")
```
**Figure 3b.** Regressions showing the relationships between Shannon diversity and statistically significant explanatory variables for the 100 m buffer distance. Relationships are shown while accounting for other variables in the model using the `visreg` package. A) Effect of anthropogenic land-use area (%) B) Interaction effect of disturbance and anthropogenic land-ues area (%).  


The next figure represents the R<sup> 2 </sup> for the top model at each buffer distance, with each line representing a different response variable. It's important to note that the top model was not always the disturbance model, however, for the top performing buffer distances, the top model was always disturbance.

```{r, echo = F, eval = T}
knitr::include_graphics("/home/icrichmond/Repositories/urban-butterflies/figures/Rsquared.jpg")
```
**Figure 4.** R<sup> 2 </sup> values for the top model at each buffer distance.  


---


## Site Investigation   
We want to identify which sites are classified as undisturbed but have high surrounding anthropogenic land-use (yellow dots at right side of panel in Figs 3a/3b).  

```{r, echo = F, eval = T, messages = F, fig.dim= c(10,10), warning = F}
suppressMessages(library(sf))
library(dplyr)
library(ggplot2)
landcov <- read_sf("large/LandCover2011_Rivers.shp")
dist <- readRDS("large/AnthroFull.rds")

dist100 <- dist$anthro100
dist100 <- dist100 %>% 
  filter(Disturbance == "Undisturbed") %>% 
  arrange(desc(anthroper))
top5 <- dist100[1:5,]
top5$anthroper <- as.numeric(top5$anthroper)

bb <- st_bbox(st_buffer(top5, 2.5))

thememain <- theme(panel.border = element_rect(size = 1, fill = NA),
                  panel.grid = element_line(color = "grey32", size = 0.2),
                  panel.background = element_rect(fill = "lightblue"),
                  axis.text = element_text(size = 11, color = 'black'),
                  axis.title = element_blank())
cols <- c("Crop and Pasture" = "#FDBF6F", "Grassland" = "#FFFF99", "River" = "#A6CEE3", "Rock Barren" = "#B15928", "Sand and Gravel" = "#FF7F00", "Settlement" = "#CAB2D6" ,"Transportation" = "#6A3D9A", "Water" = "#1F78B4", "Wetland" = "#B2DF8A", "Wooded Area" = "#33A02C")

ggplot() +
  geom_sf(aes(fill = LABEL), col = NA,  data = landcov) +
  scale_fill_manual("Land Cover Type", values = cols) +
  geom_sf(aes(size = anthroper), col="black", data = top5) +
  scale_size_continuous(range = c(2,6)) + 
  guides(size = "none") + 
  coord_sf(xlim = c(bb['xmin'], bb['xmax']),
           ylim = c(bb['ymin'], bb['ymax'])) +
  thememain

```   


**Figure 5.** Location of undisturbed sites with the highest percent anthropogenic land use in their 100 m buffer (n = 5). Sites include SWP 1428, SWP 1310, SWP 1914, SWP 1501, and SWP 1236. Values of percent anthropogenic land use range within the 100 m buffer range from 67.7% to 100%. Dot size on map corresponds to percent anthropogenic land use, with larger dots indicating a higher percent.




---


## Take-aways
These are my main take-aways after looking at these results, but I am of course eager to get everyone else's inputs on these! 

- Top-ranked buffer distances are similar for species richness and Shannon diversity but very different for abundance
- Disturbance is the top model at each of the top-ranked buffer distances 
- Mowing Disturbed/Undisturbed category most important for abundance
- Percent anthropogenic land-use most important for species richness and Shannon diversity



---

**IMPORTANT: For everyone who is curious at looking at the code for these results/all analyses done, please refer [here](https://github.com/icrichmond/UrbanButterflies) and ask me any questions you may have**


---